document.addEventListener('DOMContentLoaded', function() {
    // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
    const switchContainer = document.getElementById('switchContainer');
    const switchSlider = document.getElementById('switchSlider');
    const statusMessage = document.getElementById('statusMessage');
    const messageContainer = document.getElementById('messageContainer');
    const attemptsCount = document.getElementById('attemptsCount');
    const progressFill = document.getElementById('progressFill');
    const buyModal = document.getElementById('buyModal');
    const closeModal = document.getElementById('closeModal');
    const lockIcon = document.getElementById('lockIcon');
    const energyLevel = document.getElementById('energyLevel');
    const attemptDots = document.querySelectorAll('.attempt-dot');
    const regionErrorModal = document.getElementById('regionErrorModal');
    const closeErrorModal = document.getElementById('closeErrorModal');
    const retryButton = document.getElementById('retryButton');
    const supportButton = document.getElementById('supportButton');
    const userRegion = document.getElementById('userRegion');
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å localStorage
    const storage = {
        // –ü–æ–ª—É—á–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
        get: function(key, defaultValue) {
            const value = localStorage.getItem(key);
            return value !== null ? JSON.parse(value) : defaultValue;
        },
        
        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ
        set: function(key, value) {
            localStorage.setItem(key, JSON.stringify(value));
        },
        
        // –û—á–∏—Å—Ç–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
        clear: function() {
            localStorage.removeItem('antiban_attempts');
            localStorage.removeItem('antiban_isLocked');
            localStorage.removeItem('antiban_energy');
            localStorage.removeItem('antiban_lastUsed');
            localStorage.removeItem('antiban_totalUses');
        }
    };
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    let attempts = storage.get('antiban_attempts', 3);
    let isLocked = storage.get('antiban_isLocked', false);
    let energy = storage.get('antiban_energy', 100);
    let isOn = false; // –í—Å–µ–≥–¥–∞ –Ω–∞—á–∏–Ω–∞–µ–º —Å –≤—ã–∫–ª—é—á–µ–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    let lastUsed = storage.get('antiban_lastUsed', null);
    let totalUses = storage.get('antiban_totalUses', 0);
    
    // –°–ª—É—á–∞–π–Ω—ã–µ —Ä–µ–≥–∏–æ–Ω—ã –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
    const regions = [
        "–†–æ—Å—Å–∏—è (–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ)",
        "–ë–µ–ª–∞—Ä—É—Å—å (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ)",
        "–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ)",
        "–£–∫—Ä–∞–∏–Ω–∞ (–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ)",
        "–°–∞–Ω–∫—Ü–∏–æ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Å—Ç—Ä–∞–Ω",
        "–ù–µ–æ–ø–æ–∑–Ω–∞–Ω–Ω—ã–π —Ä–µ–≥–∏–æ–Ω"
    ];
    
    // –°–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π
    const messages = {
        off: [
            "–°–∏—Å—Ç–µ–º–∞ –∑–∞—â–∏—Ç—ã –æ—Ç–∫–ª—é—á–µ–Ω–∞",
            "–ë–∞–Ω-—â–∏–∫–∏ –º–æ–≥—É—Ç –≤–∞—Å –æ–±–Ω–∞—Ä—É–∂–∏—Ç—å!",
            "–†–∏—Å–∫ –±–∞–Ω–∞: –í–´–°–û–ö–ò–ô"
        ],
        on: [
            "–ó–∞—â–∏—Ç–∞ –æ—Ç –±–∞–Ω–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞!",
            "–í–∞—à –∞–∫–∫–∞—É–Ω—Ç –ø–æ–¥ –∑–∞—â–∏—Ç–æ–π",
            "–ù–µ–≤–∏–¥–∏–º–æ—Å—Ç—å: –ê–ö–¢–ò–í–ò–†–û–í–ê–ù–ê",
            "–ë–∞–Ω-—â–∏–∫–∏ –≤–∞—Å –Ω–µ –≤–∏–¥—è—Ç!",
            "–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö: –í–ö–õ–Æ–ß–ï–ù–û"
        ],
        warning: [
            "–í–Ω–∏–º–∞–Ω–∏–µ! –ó–∞—â–∏—Ç–∞ –æ—Å–ª–∞–±–ª–∞",
            "–≠–Ω–µ—Ä–≥–∏—è —Å–∏—Å—Ç–µ–º—ã –Ω–∞ –∏—Å—Ö–æ–¥–µ",
            "–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∞"
        ]
    };
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    initApp();
    
    // –§—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    function initApp() {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–µ
        showWelcomeMessage();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        updateUI();
        simulateRegionDetection();
        
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
        if (isLocked) {
            setTimeout(() => {
                lockSystem();
            }, 500);
        }
    }
    
    // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ
    function showWelcomeMessage() {
        if (lastUsed) {
            const lastDate = new Date(lastUsed).toLocaleDateString('ru-RU');
            const lastTime = new Date(lastUsed).toLocaleTimeString('ru-RU', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            showMessage(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –æ–±—Ä–∞—Ç–Ω–æ! –ü–æ—Å–ª–µ–¥–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ${lastDate} –≤ ${lastTime}. –û—Å—Ç–∞–ª–æ—Å—å –ø–æ–ø—ã—Ç–æ–∫: ${attempts}`, "info");
        } else {
            showMessage("–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ê–Ω—Ç–∏-–ë–∞–Ω —Å–∏—Å—Ç–µ–º—É! –£ –≤–∞—Å –µ—Å—Ç—å 3 –ø—Ä–æ–±–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏.", "info");
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        if (totalUses > 0) {
            setTimeout(() => {
                showMessage(`–í—Å–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: ${totalUses} —Ä–∞–∑`, "info");
            }, 1500);
        }
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å
    switchContainer.addEventListener('click', function() {
        if (isLocked) {
            showMessage("–°–∏—Å—Ç–µ–º–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞! –ü–æ–ø—ã—Ç–∫–∏ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å.", "error");
            return;
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        isOn = !isOn;
        
        // –ï—Å–ª–∏ –≤–∫–ª—é—á–∞–µ–º - –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ø—ã—Ç–∫—É
        if (isOn) {
            attempts--;
            totalUses++;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            saveState();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫
            updateAttempts();
            
            // –°–ª—É—á–∞–π–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏
            const randomMessage = messages.on[Math.floor(Math.random() * messages.on.length)];
            showMessage(randomMessage, "success");
            
            // –ê–Ω–∏–º–∞—Ü–∏—è —ç–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è
            energy -= 25;
            if (energy < 0) energy = 0;
            energyLevel.textContent = `${energy}%`;
            
            // –ï—Å–ª–∏ —ç–Ω–µ—Ä–≥–∏—è –Ω–∏–∑–∫–∞—è, –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
            if (energy <= 25) {
                const warningMsg = messages.warning[Math.floor(Math.random() * messages.warning.length)];
                showMessage(warningMsg, "warning");
            }
        } else {
            // –°–ª—É—á–∞–π–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–∏–∏
            const randomMessage = messages.off[Math.floor(Math.random() * messages.off.length)];
            showMessage(randomMessage, "info");
        }
        
        updateUI();
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å –ª–∏ –ø–æ–ø—ã—Ç–∫–∏
        if (attempts <= 0) {
            setTimeout(() => {
                lockSystem();
                saveState();
                showBuyModal();
            }, 1000);
        }
    });
    
    // –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
    function saveState() {
        storage.set('antiban_attempts', attempts);
        storage.set('antiban_isLocked', isLocked);
        storage.set('antiban_energy', energy);
        storage.set('antiban_lastUsed', new Date().toISOString());
        storage.set('antiban_totalUses', totalUses);
        
        // –õ–æ–≥–∏—Ä—É–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
        console.log('–°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ:', { attempts, isLocked, energy, totalUses });
    }
    
    // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
    function updateUI() {
        // –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å
        if (isOn) {
            switchContainer.classList.add('switch-on');
            switchSlider.textContent = "ON";
            statusMessage.innerHTML = '<i class="fas fa-shield-alt"></i><span>–ó–∞—â–∏—Ç–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞</span>';
            statusMessage.style.borderColor = "#0f0";
            statusMessage.style.boxShadow = "0 0 20px rgba(0, 255, 0, 0.5)";
        } else {
            switchContainer.classList.remove('switch-on');
            switchSlider.textContent = "OFF";
            statusMessage.innerHTML = '<i class="fas fa-power-off"></i><span>–°–∏—Å—Ç–µ–º–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞</span>';
            statusMessage.style.borderColor = "#f00";
            statusMessage.style.boxShadow = "0 0 20px rgba(255, 0, 0, 0.3)";
        }
        
        // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –º–µ—Ç–æ–∫
        const leftLabel = document.querySelector('.left-label');
        const rightLabel = document.querySelector('.right-label');
        
        if (isOn) {
            leftLabel.classList.remove('active');
            rightLabel.classList.add('active');
        } else {
            leftLabel.classList.add('active');
            rightLabel.classList.remove('active');
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –ø–æ–ø—ã—Ç–æ–∫
        attemptsCount.textContent = attempts;
        progressFill.style.width = `${(attempts / 3) * 100}%`;
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ—á–µ–∫ –ø–æ–ø—ã—Ç–æ–∫
        attemptDots.forEach((dot, index) => {
            if (index < attempts) {
                dot.classList.add('active');
                dot.classList.remove('inactive');
            } else {
                dot.classList.remove('active');
                dot.classList.add('inactive');
            }
        });
    }
    
    // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–∞ –ø–æ–ø—ã—Ç–æ–∫
    function updateAttempts() {
        if (attempts < 0) attempts = 0;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Å–∏—Å—Ç–µ–º—ã
    function lockSystem() {
        isLocked = true;
        switchContainer.classList.add('locked');
        lockIcon.style.opacity = "1";
        showMessage("–°–∏—Å—Ç–µ–º–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞! –ü—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω.", "error");
    }
    
    // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
    function showMessage(text, type = "info") {
        // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
        messageContainer.innerHTML = '';
        
        // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        const message = document.createElement('div');
        message.className = `message message-${type}`;
        message.textContent = text;
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∏–∫–æ–Ω–∫—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
        let icon = '';
        switch(type) {
            case "success":
                icon = '<i class="fas fa-check-circle"></i> ';
                message.style.color = "#0f0";
                break;
            case "error":
                icon = '<i class="fas fa-exclamation-circle"></i> ';
                message.style.color = "#f00";
                break;
            case "warning":
                icon = '<i class="fas fa-exclamation-triangle"></i> ';
                message.style.color = "#ffcc00";
                break;
            default:
                icon = '<i class="fas fa-info-circle"></i> ';
                message.style.color = "#0af";
        }
        
        message.innerHTML = icon + text;
        
        // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
        messageContainer.appendChild(message);
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
        setTimeout(() => {
            if (message.parentNode) {
                message.style.opacity = "0";
                message.style.transform = "translateY(-10px)";
                setTimeout(() => {
                    if (message.parentNode) {
                        messageContainer.removeChild(message);
                    }
                }, 500);
            }
        }, 5000);
    }
    
    // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ–∫—É–ø–∫–∏
    function showBuyModal() {
        buyModal.classList.add('active');
        document.body.style.overflow = "hidden";
    }
    
    // –§—É–Ω–∫—Ü–∏—è —Å–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    function hideBuyModal() {
        buyModal.classList.remove('active');
        document.body.style.overflow = "auto";
    }
    
    // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –æ–∫–Ω–∞ –æ—à–∏–±–∫–∏ —Ä–µ–≥–∏–æ–Ω–∞
    function showRegionError(plan) {
        hideBuyModal(); // –°–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ –ø–æ–∫—É–ø–∫–∏
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–∫–Ω–æ –æ—à–∏–±–∫–∏ —Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞
        setTimeout(() => {
            regionErrorModal.classList.add('active');
            document.body.style.overflow = "hidden";
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
            showMessage(`–ü–æ–ø—ã—Ç–∫–∞ –ø–æ–∫—É–ø–∫–∏ —Ç–∞—Ä–∏—Ñ–∞ "${plan}" –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞. –í–∞—à —Ä–µ–≥–∏–æ–Ω –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è.`, "error");
        }, 300);
    }
    
    // –§—É–Ω–∫—Ü–∏—è —Å–∫—Ä—ã—Ç–∏—è –æ–∫–Ω–∞ –æ—à–∏–±–∫–∏ —Ä–µ–≥–∏–æ–Ω–∞
    function hideRegionError() {
        regionErrorModal.classList.remove('active');
        document.body.style.overflow = "auto";
    }
    
    // –°–∏–º—É–ª—è—Ü–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–µ–≥–∏–æ–Ω–∞
    function simulateRegionDetection() {
        setTimeout(() => {
            const randomRegion = regions[Math.floor(Math.random() * regions.length)];
            userRegion.textContent = randomRegion;
            userRegion.style.color = "#ff6666";
            userRegion.style.animation = "pulse-red 2s infinite";
        }, 1500);
    }
    
    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ–∫—É–ø–∫–∏
    closeModal.addEventListener('click', hideBuyModal);
    
    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –æ—à–∏–±–∫–∏ —Ä–µ–≥–∏–æ–Ω–∞
    closeErrorModal.addEventListener('click', hideRegionError);
    
    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –∏—Ö
    buyModal.addEventListener('click', function(e) {
        if (e.target === buyModal) {
            hideBuyModal();
        }
    });
    
    regionErrorModal.addEventListener('click', function(e) {
        if (e.target === regionErrorModal) {
            hideRegionError();
        }
    });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ –ø–æ–∫—É–ø–∫–∏ (–≤—Å–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –æ—à–∏–±–∫—É —Ä–µ–≥–∏–æ–Ω–∞)
    document.querySelectorAll('.buy-button').forEach(button => {
        button.addEventListener('click', function() {
            const plan = this.getAttribute('data-plan');
            const planNames = {
                'basic': '–ë–∞–∑–æ–≤—ã–π (5 –ø–æ–ø—ã—Ç–æ–∫)',
                'premium': '–ü—Ä–µ–º–∏—É–º (15 –ø–æ–ø—ã—Ç–æ–∫)',
                'ultimate': '–£–ª—å—Ç–∏–º–µ–π—Ç (50 –ø–æ–ø—ã—Ç–æ–∫)'
            };
            
            showRegionError(planNames[plan] || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∞—Ä–∏—Ñ");
        });
    });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É"
    retryButton.addEventListener('click', function() {
        hideRegionError();
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–µ
        setTimeout(() => {
            showMessage("–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–≥–∏–æ–Ω–∞...", "info");
            
            // –°–Ω–æ–≤–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–≥–∏–æ–Ω (—Å–ª—É—á–∞–π–Ω—ã–π)
            setTimeout(() => {
                const randomRegion = regions[Math.floor(Math.random() * regions.length)];
                userRegion.textContent = randomRegion;
                showMessage("–†–µ–≥–∏–æ–Ω –ø—Ä–æ–≤–µ—Ä–µ–Ω. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤—Å–µ –µ—â–µ –¥–µ–π—Å—Ç–≤—É—é—Ç.", "error");
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–∫–Ω–æ –ø–æ–∫—É–ø–∫–∏ —Å–Ω–æ–≤–∞
                setTimeout(() => {
                    showBuyModal();
                }, 1000);
            }, 1500);
        }, 300);
    });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–°–ª—É–∂–±–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏"
    supportButton.addEventListener('click', function() {
        hideRegionError();
        
        setTimeout(() => {
            showMessage("–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–ª—É–∂–±–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏...", "info");
            
            // –®—É—Ç–æ—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø–æ–¥–¥–µ—Ä–∂–∫–µ
            setTimeout(() => {
                showMessage("–°–ª—É–∂–±–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏: '–ò–∑–≤–∏–Ω–∏—Ç–µ, –º—ã –Ω–∏—á–µ–≥–æ –Ω–µ –º–æ–∂–µ–º —Å–¥–µ–ª–∞—Ç—å —Å —Å–∞–Ω–∫—Ü–∏—è–º–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ VPN.'", "warning");
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø–æ–∫—É–ø–∫–µ
                setTimeout(() => {
                    const retryConfirm = confirm("–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø–æ–∫—É–ø–∫–µ —Ç–∞—Ä–∏—Ñ–æ–≤?");
                    if (retryConfirm) {
                        showBuyModal();
                    }
                }, 2000);
            }, 2000);
        }, 500);
    });
    
    // –ê–Ω–∏–º–∞—Ü–∏—è —ç–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è (—Å–∏–º—É–ª—è—Ü–∏—è)
    setInterval(() => {
        if (isOn && energy > 0) {
            energy -= 0.5;
            if (energy < 0) energy = 0;
            energyLevel.textContent = `${Math.round(energy)}%`;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏
            saveState();
            
            // –ï—Å–ª–∏ —ç–Ω–µ—Ä–≥–∏—è –Ω–∞ –∏—Å—Ö–æ–¥–µ, –º–∏–≥–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º
            if (energy <= 10) {
                energyLevel.style.animation = energyLevel.style.animation ? "" : "pulse 0.5s infinite alternate";
            } else {
                energyLevel.style.animation = "";
            }
            
            // –ï—Å–ª–∏ —ç–Ω–µ—Ä–≥–∏—è –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å, –≤—ã–∫–ª—é—á–∞–µ–º —Å–∏—Å—Ç–µ–º—É
            if (energy <= 0) {
                isOn = false;
                updateUI();
                showMessage("–≠–Ω–µ—Ä–≥–∏—è —Å–∏—Å—Ç–µ–º—ã –∏—Å—á–µ—Ä–ø–∞–Ω–∞! –ó–∞—â–∏—Ç–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞.", "error");
            }
        }
    }, 3000);
    
    // –î–æ–±–∞–≤–∏—Ç—å –∑–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    switchContainer.addEventListener('mousedown', function() {
        // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∑–≤—É–∫ —â–µ–ª—á–∫–∞
        console.log("–©–µ–ª—á–æ–∫ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è (–∑–≤—É–∫–æ–≤–æ–π —ç—Ñ—Ñ–µ–∫—Ç)");
    });
    
    // –î–æ–±–∞–≤–∏—Ç—å —ç—Ñ—Ñ–µ–∫—Ç –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ —Ç–æ—á–∫–∏ –ø–æ–ø—ã—Ç–æ–∫
    attemptDots.forEach(dot => {
        dot.addEventListener('mouseenter', function() {
            if (this.classList.contains('inactive')) {
                this.style.transform = "scale(1.3)";
                this.style.backgroundColor = "#f00";
            }
        });
        
        dot.addEventListener('mouseleave', function() {
            this.style.transform = "";
            if (this.classList.contains('inactive')) {
                this.style.backgroundColor = "#333";
            }
        });
    });
    
    // –î–æ–±–∞–≤–∏—Ç—å —ç—Ñ—Ñ–µ–∫—Ç –¥–ª—è –∫–Ω–æ–ø–æ–∫ –ø–æ–∫—É–ø–∫–∏
    document.querySelectorAll('.buy-button').forEach(button => {
        button.addEventListener('mouseenter', function() {
            this.style.transform = "scale(1.05)";
            this.style.boxShadow = "0 0 20px rgba(255, 255, 255, 0.3)";
        });
        
        button.addEventListener('mouseleave', function() {
            this.style.transform = "";
            this.style.boxShadow = "";
        });
    });
    
    // –î–æ–±–∞–≤–∏—Ç—å —ç—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è –∫–Ω–æ–ø–æ–∫ –≤ –æ–∫–Ω–µ –æ—à–∏–±–∫–∏
    document.querySelectorAll('.btn-primary, .btn-secondary').forEach(button => {
        button.addEventListener('mouseenter', function() {
            this.style.transform = "translateY(-2px)";
        });
        
        button.addEventListener('mouseleave', function() {
            this.style.transform = "";
        });
    });
    
    // –î–æ–±–∞–≤–∏—Ç—å —ç—Ñ—Ñ–µ–∫—Ç—ã –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ —Ç–∞—Ä–∏—Ñ—ã
    document.querySelectorAll('.pricing-option').forEach(option => {
        option.addEventListener('mouseenter', function() {
            this.style.boxShadow = "0 10px 30px rgba(0, 255, 0, 0.3)";
        });
        
        option.addEventListener('mouseleave', function() {
            this.style.boxShadow = "";
        });
    });
    
    // –î–æ–±–∞–≤–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏—é –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω–æ–≥–æ —Ç–∞—Ä–∏—Ñ–∞
    const popularOption = document.querySelector('.pricing-option.popular');
    if (popularOption) {
        setInterval(() => {
            popularOption.style.boxShadow = popularOption.style.boxShadow 
                ? "" 
                : "0 0 30px rgba(255, 204, 0, 0.7)";
        }, 2000);
    }
    
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–µ—Å–∞
    setInterval(() => {
        // –°–ª—É—á–∞–π–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞
        if (Math.random() > 0.7) {
            const title = document.querySelector('.main-title');
            title.style.transform = "scale(1.02)";
            setTimeout(() => {
                title.style.transform = "";
            }, 300);
        }
        
        // –°–ª—É—á–∞–π–Ω–æ–µ –º–∏–≥–∞–Ω–∏–µ —Ç–æ—á–µ–∫ –ø–æ–ø—ã—Ç–æ–∫
        if (Math.random() > 0.8 && attempts > 0) {
            const randomDot = document.querySelector(`.attempt-dot:nth-child(${Math.floor(Math.random() * attempts) + 1})`);
            if (randomDot && randomDot.classList.contains('active')) {
                randomDot.style.transform = "scale(1.5)";
                randomDot.style.boxShadow = "0 0 20px #0f0";
                setTimeout(() => {
                    randomDot.style.transform = "";
                    randomDot.style.boxShadow = "";
                }, 500);
            }
        }
    }, 3000);
    
    // –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É —Å–±—Ä–æ—Å–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (—Å–∫—Ä—ã—Ç—É—é, –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
    addResetButton();
    
    // –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–Ω–æ–ø–∫–∏ —Å–±—Ä–æ—Å–∞ (—Å–∫—Ä—ã—Ç–∞—è)
    function addResetButton() {
        const resetButton = document.createElement('button');
        resetButton.innerHTML = 'üîÑ –°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å';
        resetButton.style.position = 'fixed';
        resetButton.style.bottom = '10px';
        resetButton.style.right = '10px';
        resetButton.style.padding = '5px 10px';
        resetButton.style.fontSize = '12px';
        resetButton.style.backgroundColor = '#333';
        resetButton.style.color = '#0f0';
        resetButton.style.border = '1px solid #0f0';
        resetButton.style.borderRadius = '5px';
        resetButton.style.cursor = 'pointer';
        resetButton.style.zIndex = '1000';
        resetButton.style.opacity = '0.3';
        resetButton.style.transition = 'opacity 0.3s';
        
        resetButton.addEventListener('mouseenter', () => {
            resetButton.style.opacity = '1';
        });
        
        resetButton.addEventListener('mouseleave', () => {
            resetButton.style.opacity = '0.3';
        });
        
        resetButton.addEventListener('click', () => {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å? –ü–æ–ø—ã—Ç–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –¥–æ 3.')) {
                storage.clear();
                attempts = 3;
                isLocked = false;
                energy = 100;
                isOn = false;
                totalUses = 0;
                lastUsed = null;
                
                updateUI();
                switchContainer.classList.remove('locked');
                lockIcon.style.opacity = "0";
                
                showMessage("–ü—Ä–æ–≥—Ä–µ—Å—Å —Å–±—Ä–æ—à–µ–Ω! –ü–æ–ø—ã—Ç–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã.", "success");
                
                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —á–µ—Ä–µ–∑ 1.5 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    location.reload();
                }, 1500);
            }
        });
        
        document.body.appendChild(resetButton);
    }
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    window.addEventListener('beforeunload', function() {
        saveState();
    });
    
    // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)
    setInterval(saveState, 30000); // –ö–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
});
